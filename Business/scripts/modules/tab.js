import{sleep,elementIsExistWithLog}from"./general.js";export var ToggleTabsEvent;!function(t){t[t.Click=0]="Click",t[t.Hover=1]="Hover"}(ToggleTabsEvent||(ToggleTabsEvent={}));export default class Tab{constructor(t){if(this.isToggling=!1,this.autoHeight=!1,this.toggleTabsEvent="click",this.containerheight=0,this.buttonsActiveClass="active",this.contentActiveClass="active",!elementIsExistWithLog("Tab",t.btnsSelector,t.contentBlocksSelector))return;if(this.buttons=document.querySelectorAll(t.btnsSelector),this.contentElements=document.querySelectorAll(t.contentBlocksSelector),this.buttons.length!=this.contentElements.length)return void console.log("[Tab] The count of buttons and content-elements is not equal.");t.buttonsActiveClass&&(this.buttonsActiveClass=t.buttonsActiveClass),t.contentActiveClass&&(this.contentActiveClass=t.contentActiveClass),null!=t.firstButtonIsNotActive&&0!=t.firstButtonIsNotActive||this.buttons[0].classList.add(this.buttonsActiveClass),this.contentElements[0].classList.add(this.contentActiveClass),t.autoHeight&&(this.autoHeight=t.autoHeight);let e=document.querySelector(t.contentBlocksSelector);if(this.parentOfContentElements=e.parentElement,t.animationDuration?this.animationDuration=t.animationDuration:this.animationDuration=1e3*parseFloat(getComputedStyle(e).getPropertyValue("transition-duration")),this.switchingLockTime=this.animationDuration,this.setToggleTabsEvent(t.toggleTabsBy),t.fadeEffect){this.setFadeTabs(),window.addEventListener("resize",this.resizeFadeTabs.bind(this));for(let t of this.buttons)t.addEventListener(this.toggleTabsEvent,(()=>this.toggleTabsFade(t)))}else{this.setDefaultTabs();for(let t of this.buttons)t.addEventListener(this.toggleTabsEvent,(()=>this.toggleTabs(t)))}}setFadeTabs(){let t=0;for(let e of this.contentElements)!this.autoHeight&&e.clientHeight>this.containerheight?this.containerheight=e.clientHeight:this.autoHeight&&this.containerheight<=0&&(this.containerheight=this.contentElements[0].clientHeight),0==e.classList.contains(this.contentActiveClass)&&(e.style.opacity="0"),e.style.transform=`translateY(-${t}px)`,t+=e.clientHeight;this.parentOfContentElements.style.display="flex",this.parentOfContentElements.style.flexDirection="column",this.parentOfContentElements.style.overflow="hidden",this.setContainerHeight(this.containerheight),this.parentOfContentElements.style.transition=`height ${this.animationDuration}ms`;for(let e of this.contentElements)e.style.transition=`opacity ${this.animationDuration}ms`}setDefaultTabs(){for(let t of this.contentElements)0==t.classList.contains(this.contentActiveClass)&&(t.setAttribute("hidden",""),t.style.display="none",t.style.opacity="0"),t.style.transition=`opacity ${this.animationDuration}ms`,this.setContainerHeight(),this.parentOfContentElements.style.transition=`height ${this.animationDuration}ms`}resizeFadeTabs(){let t=this.getCurrentActiveTab(),e=0;this.parentOfContentElements.style.height=t?`${t.clientHeight}px`:`${this.contentElements[0].clientHeight}px`;for(let s of this.contentElements)s.style.transform=`translateY(-${e}px)`,e+=s.clientHeight}toggleTabsFade(t){if(0==this.toggleTogglingStateIfPossible(t))return;this.toggleTabButtons(t);let e=this.getCurrentActiveTab(),s=this.getTabByPressedButton(t);e.style.opacity="0",this.autoHeight&&this.setContainerHeight(s.clientHeight),s.style.opacity="1",e.classList.remove(this.contentActiveClass),s.classList.add(this.contentActiveClass),setTimeout((()=>{this.isToggling=!1}),this.switchingLockTime)}async toggleTabs(t){if(0==this.toggleTogglingStateIfPossible(t))return;this.toggleTabButtons(t);let e=this.getCurrentActiveTab(),s=this.getTabByPressedButton(t);e.classList.remove(this.contentActiveClass),e.style.opacity="0",await sleep(this.animationDuration),e.setAttribute("hidden",""),e.style.display="none",s.removeAttribute("hidden"),s.style.display="",this.setContainerHeight(s.clientHeight),await sleep(20),s.style.opacity="1",s.classList.add(this.contentActiveClass),setTimeout((()=>{this.isToggling=!1}),this.switchingLockTime)}toggleTabButtons(t){for(let e of this.buttons)e!=t?e.classList.remove(this.buttonsActiveClass):e.classList.add(this.buttonsActiveClass)}toggleTogglingStateIfPossible(t){return!t.classList.contains(this.buttonsActiveClass)&&!this.isToggling&&(this.isToggling=!0,!0)}getCurrentActiveTab(){for(let t of this.contentElements)if(t.classList.contains(this.contentActiveClass))return t}getTabByPressedButton(t){return this.contentElements[t.dataset.toggleElemNumber]}setContainerHeight(t){this.parentOfContentElements.style.height=t?`${t}px`:`${this.contentElements[0].clientHeight}px`}setToggleTabsEvent(t){if(t===ToggleTabsEvent.Hover)this.toggleTabsEvent="mouseenter",this.switchingLockTime=0;else this.toggleTabsEvent="click"}}